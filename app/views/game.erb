<div class="container">
  <div class="game-container">
    <div class="header">
      <h1>Tic Tac Toe</h1>
      
      <!-- Difficulty Indicator (for bot mode) -->
      <% if @game_mode == 'bot' && @difficulty && @player_symbol %>
        <div class="difficulty-indicator" style="margin: 10px 0; padding: 8px 15px; background: rgba(255,255,255,0.1); border-radius: 20px; display: inline-block;">
          Difficulty: 
          <span style="font-weight: bold; 
            <% if @difficulty == 'easy' %>color: #4CAF50;<% end %>
            <% if @difficulty == 'normal' %>color: #FF9800;<% end %>
            <% if @difficulty == 'hard' %>color: #F44336;<% end %>">
            <%= @difficulty.capitalize %>
          </span>
          | You are: <span class="player-<%= @player_symbol.downcase if @player_symbol %>"><%= @player_symbol %></span>
        </div>
      <% end %>
      
      <div class="score-board">
        <div class="score-item">
          <span class="score-label">
            <% if @game_mode == 'bot' && @player_symbol == 'X' %>
              You (X)
            <% elsif @game_mode == 'bot' && @bot_symbol == 'X' %>
              Bot (X)
            <% else %>
              X
            <% end %>
          </span>
          <span class="score-value" id="x-score"><%= @scores['X'] || 0 %></span>
        </div>
        <div class="score-divider">|</div>
        <div class="score-item">
          <span class="score-label">
            <% if @game_mode == 'bot' && @player_symbol == 'O' %>
              You (O)
            <% elsif @game_mode == 'bot' && @bot_symbol == 'O' %>
              Bot (O)
            <% else %>
              O
            <% end %>
          </span>
          <span class="score-value" id="o-score"><%= @scores['O'] || 0 %></span>
        </div>
      </div>
      <div class="status" id="status">
        <% if @winner %>
          <% if @winner == 'draw' %>
            It's a Draw!
          <% else %>
            <% if @game_mode == 'bot' %>
              <% if @winner == @player_symbol %>
                <span class="player-<%= @player_symbol.downcase if @player_symbol %>">You Win!</span>
              <% else %>
                <span class="player-<%= @bot_symbol.downcase if @bot_symbol %>">Bot Wins!</span>
              <% end %>
            <% else %>
              Player <span class="player-<%= @winner.downcase if @winner %>"><%= @winner %></span> Wins!
            <% end %>
          <% end %>
        <% else %>
          <% if @game_mode == 'bot' && @player_symbol && @bot_symbol %>
            <% if @current_player == @player_symbol %>
              Your turn (<span class="player-<%= @player_symbol.downcase %>"><%= @player_symbol %></span>)
            <% else %>
              Bot's turn (<span class="player-<%= @bot_symbol.downcase %>"><%= @bot_symbol %></span>)
            <% end %>
          <% else %>
            Current Player: <span class="player-<%= @current_player.downcase if @current_player %>"><%= @current_player %></span>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="board" id="board">
      <% (0..8).each do |i| %>
        <% value = @board[i] %>
        <a href="/move/<%= i %>" class="cell<% if value %> taken <%= value.downcase %><% end %>">
          <%= value %>
        </a>
      <% end %>
    </div>

    <div class="controls">
      <button class="btn btn-primary" id="reset-btn">New Game</button>
      <a href="/" class="btn btn-secondary">Back to Home</a>
    </div>
  </div>
</div>

<script>
  // Add click handlers to reset button
  document.getElementById('reset-btn').addEventListener('click', function(e) {
    e.preventDefault();
    fetch('/api/reset', { method: 'POST' })
      .then(() => window.location.reload());
  });

  // Highlight winning cells if there's a winner
  <% if @winner && @winner != 'draw' %>
    const board = <%= @board.inspect %>;
    const winner = '<%= @winner %>';
    const winningCombos = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8],
      [0, 3, 6], [1, 4, 7], [2, 5, 8],
      [0, 4, 8], [2, 4, 6]
    ];

    winningCombos.forEach(combo => {
      if (board[combo[0]] && board[combo[0]] === winner && 
          board[combo[1]] === winner && board[combo[2]] === winner) {
        document.querySelectorAll('.cell').forEach((cell, idx) => {
          if (combo.includes(idx)) {
            cell.classList.add('winner-cell');
          }
        });
      }
    });
  <% end %>
</script>